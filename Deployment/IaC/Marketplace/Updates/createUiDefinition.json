{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "resourceTypes": ["microsoft.resources/resourcegroups"],
    "config": {
      "isWizard": false,
      "basics": {
        "description": "Information on this screen will define the naming used for the Azure resources created as well as the default domain name & URL if an existing private domain is not used. It is suggested that this application be deployed to US Gov Arizona region as require resources may not be available in other regions. The Agency Abbreviation and Application Name are combined to create a globally unique name & URL for this application instance.",
        "resourceGroup": {
          "constraints": {
            "validations": []
          },
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "agency_dropdown",
        "type": "Microsoft.Common.DropDown",
        "label": "Agency",
        "toolTip": "Select the agency that you are deploying this application for.",
        "constraints": {
          "allowedValues": [
            {
              "label": "ALAMEDA SHERIFF",
              "value": {
                "county": "Alameda",
                "abbreviation": "alameda",
                "type": "sd",
                "ori": "CA0010000"
              }
            },
            {
              "label": "ALPINE SHERIFF",
              "value": {
                "county": "Alpine",
                "abbreviation": "alpine",
                "type": "sd",
                "ori": "CA0020000"
              }
            },
            {
              "label": "AMADOR SHERIFF",
              "value": {
                "county": "Amador",
                "abbreviation": "ac",
                "type": "so",
                "ori": "CA0030000"
              }
            },
            {
              "label": "BUTTE SHERIFF",
              "value": {
                "county": "Butte",
                "abbreviation": "bc",
                "type": "so",
                "ori": "CA0040000"
              }
            },
            {
              "label": "CALAVERAS SHERIFF",
              "value": {
                "county": "Calaveras",
                "abbreviation": "cc",
                "type": "so",
                "ori": "CA0050000"
              }
            },
            {
              "label": "CAMPBELL POLICE",
              "value": {
                "county": "Santa Clara",
                "abbreviation": "c",
                "type": "pd",
                "ori": "CA0430200"
              }
            },
            {
              "label": "COLUSA SHERIFF",
              "value": {
                "county": "Colusa",
                "abbreviation": "colusa",
                "type": "sd",
                "ori": "CA0060000"
              }
            },
            {
              "label": "CONTRA COSTA SHERIFF",
              "value": {
                "county": "Contra Costa",
                "abbreviation": "ccc",
                "type": "so",
                "ori": "CA0070000"
              }
            },
            {
              "label": "CYPRESS POLICE",
              "value": {
                "county": "Orange",
                "abbreviation": "cy",
                "type": "pd",
                "ori": "CA0300500"
              }
            },
            {
              "label": "DEL NORTE SHERIFF",
              "value": {
                "county": "Del Norte",
                "abbreviation": "delnorte",
                "type": "sd",
                "ori": "CA0080000"
              }
            },
            {
              "label": "EL CAJON POLICE",
              "value": {
                "county": "San Diego",
                "abbreviation": "ec",
                "type": "pd",
                "ori": "CA0370500"
              }
            },
            {
              "label": "EL DORADO SHERIFF",
              "value": {
                "county": "El Dorado",
                "abbreviation": "ed",
                "type": "so",
                "ori": "CA0090000"
              }
            },
            {
              "label": "FRESNO SHERIFF",
              "value": {
                "county": "Fresno",
                "abbreviation": "fresno",
                "type": "sd",
                "ori": "CA0100000"
              }
            },
            {
              "label": "GLENN SHERIFF",
              "value": {
                "county": "Glenn",
                "abbreviation": "gc",
                "type": "so",
                "ori": "CA0110000"
              }
            },
            {
              "label": "HUMBOLDT SHERIFF",
              "value": {
                "county": "Humboldt",
                "abbreviation": "hc",
                "type": "so",
                "ori": "CA0120000"
              }
            },
            {
              "label": "IMPERIAL SHERIFF",
              "value": {
                "county": "Imperial",
                "abbreviation": "imperial",
                "type": "sd",
                "ori": "CA0130000"
              }
            },
            {
              "label": "INYO SHERIFF",
              "value": {
                "county": "Inyo",
                "abbreviation": "inyo",
                "type": "sd",
                "ori": "CA0140000"
              }
            },
            {
              "label": "KERN SHERIFF",
              "value": {
                "county": "Kern",
                "abbreviation": "kc",
                "type": "so1",
                "ori": "CA0150000"
              }
            },
            {
              "label": "KINGS SHERIFF",
              "value": {
                "county": "Kings",
                "abbreviation": "kc",
                "type": "so",
                "ori": "CA0160000"
              }
            },
            {
              "label": "LAKE SHERIFF",
              "value": {
                "county": "Lake",
                "abbreviation": "lc",
                "type": "so",
                "ori": "CA0170000"
              }
            },
            {
              "label": "LASSEN SHERIFF",
              "value": {
                "county": "Lassen",
                "abbreviation": "lassen",
                "type": "sd",
                "ori": "CA0180000"
              }
            },
            {
              "label": "LIVERMORE POLICE",
              "value": {
                "county": "Alameda",
                "abbreviation": "l",
                "type": "pd",
                "ori": "CA0010700"
              }
            },
            {
              "label": "LOS ALTOS POLICE",
              "value": {
                "county": "Sanata CLara",
                "abbreviation": "sccla",
                "type": "pd",
                "ori": "CA0430500"
              }
            },
            {
              "label": "LOS ANGELES SHERIFF",
              "value": {
                "county": "Los Angeles",
                "abbreviation": "la",
                "type": "sd",
                "ori": "CA0190000"
              }
            },
            {
              "label": "MADERA SHERIFF",
              "value": {
                "county": "Madera",
                "abbreviation": "mc",
                "type": "so5",
                "ori": "CA0200000"
              }
            },
            {
              "label": "MARIN SHERIFF",
              "value": {
                "county": "Marin",
                "abbreviation": "mc",
                "type": "so4",
                "ori": "CA0210000"
              }
            },
            {
              "label": "MARIPOSA SHERIFF",
              "value": {
                "county": "Mariposa",
                "abbreviation": "mc",
                "type": "so3",
                "ori": "CA0220000"
              }
            },
            {
              "label": "MENDOCINO SHERIFF",
              "value": {
                "county": "Mendocino",
                "abbreviation": "mc",
                "type": "so6",
                "ori": "CA0230000"
              }
            },
            {
              "label": "MERCED SHERIFF",
              "value": {
                "county": "Merced",
                "abbreviation": "mc",
                "type": "so2",
                "ori": "CA0240000"
              }
            },
            {
              "label": "MODOC SHERIFF",
              "value": {
                "county": "Modoc",
                "abbreviation": "mc",
                "type": "so",
                "ori": "CA0250000"
              }
            },
            {
              "label": "MONO SHERIFF",
              "value": {
                "county": "Mono",
                "abbreviation": "mono",
                "type": "sd",
                "ori": "CA0260000"
              }
            },
            {
              "label": "MONTEREY SHERIFF",
              "value": {
                "county": "Monterey",
                "abbreviation": "mc",
                "type": "so1",
                "ori": "CA0270000"
              }
            },
            {
              "label": "NAPA SHERIFF",
              "value": {
                "county": "Napa",
                "abbreviation": "n",
                "type": "so",
                "ori": "CA0280000"
              }
            },
            {
              "label": "NEVADA SHERIFF",
              "value": {
                "county": "Nevada",
                "abbreviation": "nc",
                "type": "so",
                "ori": "CA0290000"
              }
            },
            {
              "label": "ORANGE SHERIFF",
              "value": {
                "county": "Orange",
                "abbreviation": "oc",
                "type": "sd",
                "ori": "CA0300000"
              }
            },
            {
              "label": "PLACER SHERIFF",
              "value": {
                "county": "Placer",
                "abbreviation": "pc",
                "type": "so1",
                "ori": "CA0310000"
              }
            },
            {
              "label": "PLUMAS SHERIFF",
              "value": {
                "county": "Plumas",
                "abbreviation": "pc",
                "type": "so",
                "ori": "CA0320000"
              }
            },
            {
              "label": "RIVERSIDE SHERIFF",
              "value": {
                "county": "Riverside",
                "abbreviation": "r",
                "type": "so",
                "ori": "CA0330000"
              }
            },
            {
              "label": "SACRAMENTO SHERIFF",
              "value": {
                "county": "Sacramento",
                "abbreviation": "sacramento",
                "type": "sd",
                "ori": "CA0340000"
              }
            },
            {
              "label": "SAN BENITO SHERIFF",
              "value": {
                "county": "San Benito",
                "abbreviation": "sbc",
                "type": "so",
                "ori": "CA0350000"
              }
            },
            {
              "label": "SAN BERNARDINO SHERIFF",
              "value": {
                "county": "San Bernardino",
                "abbreviation": "sbc",
                "type": "sd",
                "ori": "CA0360000"
              }
            },
            {
              "label": "SAN DIEGO POLICE",
              "value": {
                "county": "San Diego",
                "abbreviation": "sd",
                "type": "pd",
                "ori": "CA0371100"
              }
            },
            {
              "label": "SAN DIEGO SHERIFF",
              "value": {
                "county": "San Diego",
                "abbreviation": "sd",
                "type": "sd",
                "ori": "CA0370000"
              }
            },
            {
              "label": "SAN FRANCISCO SHERIFF",
              "value": {
                "county": "San Francisco",
                "abbreviation": "sf",
                "type": "so",
                "ori": "CA0380000"
              }
            },
            {
              "label": "SAN JOAQUIN SHERIFF",
              "value": {
                "county": "San Joaquin",
                "abbreviation": "sjc",
                "type": "so",
                "ori": "CA0390000"
              }
            },
            {
              "label": "SAN LUIS OBISPO SHERIFF",
              "value": {
                "county": "San Luis Obispo",
                "abbreviation": "slo",
                "type": "so",
                "ori": "CA0400000"
              }
            },
            {
              "label": "SAN MATEO SHERIFF",
              "value": {
                "county": "San Mateo",
                "abbreviation": "smc",
                "type": "so",
                "ori": "CA0410000"
              }
            },
            {
              "label": "SANTA BARBARA SHERIFF",
              "value": {
                "county": "Santa Barbara",
                "abbreviation": "sb",
                "type": "so",
                "ori": "CA0420000"
              }
            },
            {
              "label": "SANTA CLARA SHERIFF",
              "value": {
                "county": "Santa Clara",
                "abbreviation": "scc",
                "type": "so",
                "ori": "CA0430000"
              }
            },
            {
              "label": "SANTA CRUZ SHERIFF",
              "value": {
                "county": "Santa Cruz",
                "abbreviation": "sc",
                "type": "so1",
                "ori": "CA0440000"
              }
            },
            {
              "label": "SHASTA SHERIFF",
              "value": {
                "county": "Shasta",
                "abbreviation": "shasta",
                "type": "sd",
                "ori": "CA0450000"
              }
            },
            {
              "label": "SIERRA SHERIFF",
              "value": {
                "county": "Sierra",
                "abbreviation": "sc",
                "type": "so2",
                "ori": "CA0460000"
              }
            },
            {
              "label": "SISKIYOU SHERIFF",
              "value": {
                "county": "Siskiyou",
                "abbreviation": "sc",
                "type": "so4",
                "ori": "CA0470000"
              }
            },
            {
              "label": "SOLANO SHERIFF",
              "value": {
                "county": "Solano",
                "abbreviation": "solano",
                "type": "sd",
                "ori": "CA0480000"
              }
            },
            {
              "label": "SONOMA SHERIFF",
              "value": {
                "county": "Sonoma",
                "abbreviation": "sc",
                "type": "so",
                "ori": "CA0490000"
              }
            },
            {
              "label": "STANISLAUS SHERIFF",
              "value": {
                "county": "Stanislaus",
                "abbreviation": "sc",
                "type": "sd",
                "ori": "CA0500000"
              }
            },
            {
              "label": "SUTTER SHERIFF",
              "value": {
                "county": "Sutter",
                "abbreviation": "sc",
                "type": "so3",
                "ori": "CA0510000"
              }
            },
            {
              "label": "TEHAMA SHERIFF",
              "value": {
                "county": "Tehama",
                "abbreviation": "tehama",
                "type": "sd",
                "ori": "CA0520000"
              }
            },
            {
              "label": "TRINITY SHERIFF",
              "value": {
                "county": "Trinity",
                "abbreviation": "trinity",
                "type": "sd",
                "ori": "CA0530000"
              }
            },
            {
              "label": "TULARE SHERIFF",
              "value": {
                "county": "Tulare",
                "abbreviation": "tc",
                "type": "so1",
                "ori": "CA0540000"
              }
            },
            {
              "label": "TUOLUMNE SHERIFF",
              "value": {
                "county": "Tuolumne",
                "abbreviation": "tc",
                "type": "so",
                "ori": "CA0550000"
              }
            },
            {
              "label": "VENTURA SHERIFF",
              "value": {
                "county": "Ventura",
                "abbreviation": "vc",
                "type": "so",
                "ori": "CA0560000"
              }
            },
            {
              "label": "YOLO SHERIFF",
              "value": {
                "county": "Yolo",
                "abbreviation": "yolo",
                "type": "sd",
                "ori": "CA0570000"
              }
            },
            {
              "label": "YUBA SHERIFF",
              "value": {
                "county": "Yuba",
                "abbreviation": "yc",
                "type": "so",
                "ori": "CA0580000"
              }
            }
          ],
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "steps_authentication",
        "label": "Authentication",
        "subLabel": {},
        "elements": [
          {
            "name": "auth_instructions",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This application uses Azure Active Directory, OAuth/OpenID and RBAC. This requires an \"App Registration\" (AR) be created (or use an existing) in the Azure AD Tenant that you wish to use to for authentication & authorization. The AR needs to have several key properties and settings configured in order to work properly. Please review the link below for required settings and scripts that can be used to create a new AR in your tenant.",
              "link": {
                "label": "Instructions and scripts download",
                "uri": "https://github.com/SanDiegoCountySheriff/Cal-RIPA/tree/main/Deployment/Scripts/Authentication"
              }
            },
            "visible": true
          },
          {
            "name": "auth_fqdn",
            "type": "Microsoft.Common.TextBox",
            "label": "Azure AD FQDN",
            "placeholder": "sample.gov",
            "toolTip": "This should be an AAD fully qualified domain name of the tenant being used for authentication. I.e. myorganization.gov",
            "constraints": {
              "required": true,
              "regex": "^([a-zA-Z0-9-]{3,100}\\.[a-zA-Z]{2,10}){1}",
              "validationMessage": ""
            },
            "visible": true
          },
          {
            "name": "auth_app_id",
            "type": "Microsoft.Common.TextBox",
            "label": "AAD App Registration ID",
            "placeholder": "********-****-****-****-************",
            "toolTip": "This should be a valid App ID (clientId) configured for RIPA authentication.",
            "constraints": {
              "required": true,
              "regex": "^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$",
              "validationMessage": "You must provide a valid GUID/UUID in the format of ********-****-****-****-************."
            },
            "visible": true
          },
          {
            "name": "auth_tenant_id",
            "type": "Microsoft.Common.TextBox",
            "label": "Tenant ID",
            "placeholder": "********-****-****-****-************",
            "toolTip": "This should be the GUID (tenant_id) of the tenant being used for authentication.",
            "constraints": {
              "required": true,
              "regex": "^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$",
              "validationMessage": "You must provide a valid GUID/UUID in the format of ********-****-****-****-************."
            },
            "visible": true
          }
        ]
      },
      {
        "name": "steps_doj",
        "label": "DOJ SFTP",
        "subLabel": {},
        "elements": [
          {
            "name": "doj_environment",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "DoJ Test or Production configuration",
            "defaultValue": "Production",
            "toolTip": "Choose the DoJ sFTP environment configuration you would like to set up for this deployment",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Production",
                  "value": "PROD"
                },
                {
                  "label": "Test (non-production)",
                  "value": "TEST"
                }
              ],
              "required": false
            },
            "visible": true
          }
        ]
      }
    ],
    "outputs": {
      "agency_abbreviation": "[concat(basics('agency_dropdown').abbreviation, basics('agency_dropdown').type)]",
      "agency_ori": "[basics('agency_dropdown').ori]",
      "auth_fqdn": "[steps('steps_authentication').auth_fqdn]",
      "auth_app_id": "[steps('steps_authentication').auth_app_id]",
      "auth_tenant_id": "[steps('steps_authentication').auth_tenant_id]",
      "doj_environment": "[steps('steps_doj').doj_environment]"
    }
  }
}
