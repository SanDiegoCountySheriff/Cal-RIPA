# ASP.NET Core (.NET Framework)
# Build and test ASP.NET Core projects targeting the full .NET Framework.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
- dev


pool:
  vmImage: 'windows-latest'

stages:
  - stage: Build
    displayName: 'Build'
    variables:
      buildConfiguration: 'Release'
      projectToBuild: "$(System.DefaultWorkingDirectory)"
    
    jobs:
    - job: job_1
      displayName: 'build .net core function api'
    
      steps:
      
      - task: UseDotNet@2
        displayName: 'Use .NET Core sdk 3.1.404'
        inputs:
          version: 3.1.404

      - task: DotNetCoreCLI@2
        inputs:
          command: 'restore'
          projects: '$(projectToBuild)/*$(BackEndServc).csproj'
          feedsToUse: 'select'
          vstsFeed: 'e1fc634d-7bab-453f-a4a8-f3440249240f/294e5da2-a661-49bf-bf3f-3bab6aa42171'
      - task: DotNetCoreCLI@2
        displayName: Build project
        inputs:
          projects: '$(projectToBuild)/*$(BackEndServc).csproj'
          arguments: --output publish_output --configuration Release

      - task: DotNetCoreCLI@2
        displayName: Test
        inputs:
          command: test
          projects: '$(projectToBuild)/*$(BackEndServc).csproj'
          testRunTitle: SampleTest
      
      - task: ArchiveFiles@2
        inputs:
          rootFolderOrFile: '$(Build.BinariesDirectory)'
          includeRootFolder: true
          archiveType: 'zip'
          archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
          replaceExistingArchive: true
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: 'drop'
          publishLocation: 'Container'
      